<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>bateekh Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <nav>
        <div class="nav-left">
            <div class="logo"></div>
            <span class="site-name">bateekh</span>
        </div>
        <div class="nav-links">
            <a href="/dashboard"><i class="fa-solid fa-house"></i> Dashboard</a>
            <a href="/logout"><i class="fa-solid fa-right-from-bracket"></i> Logout</a>
        </div>
    </nav>
    <div class="dashboard-main">
        <aside class="dashboard-sidebar glass">
            <div class="profile-card">
                <div class="profile-avatar">
                    <span class="avatar-icon">üçâ</span>
                </div>
                <div class="profile-info">
                    <div class="profile-username" id="profile-username">Welcome!</div>
                    <div class="profile-desc">Enjoy your social feed üçâ</div>
                </div>
            </div>
            <div class="sidebar-section glass">
                <h3><i class="fa-solid fa-user-group"></i> Friends</h3>
                <div id="friend-list" class="sidebar-list"></div>
            </div>
            <div class="sidebar-section glass">
                <h4><i class="fa-solid fa-clock"></i> Pending Requests</h4>
                <div id="pending-requests" class="sidebar-list"></div>
            </div>
            <div class="sidebar-section glass">
                <h4><i class="fa-solid fa-paper-plane"></i> Sent Requests</h4>
                <div id="sent-requests" class="sidebar-list"></div>
            </div>
            <div class="sidebar-section glass">
                <h4><i class="fa-solid fa-user-plus"></i> Send Friend Request</h4>
                <form id="send-friend-form" class="sidebar-form">
                    <input type="text" id="friend-username" placeholder="Username" required>
                    <button type="submit"><i class="fa-solid fa-plus"></i> Send</button>
                </form>
                <div id="send-friend-feedback" class="feedback" style="display:none;"></div>
            </div>
            <div class="sidebar-section glass">
                <h4><i class="fa-solid fa-lightbulb"></i> Friend Suggestions</h4>
                <div id="friend-suggestions" class="sidebar-list"></div>
            </div>
        </aside>
        <main class="dashboard-content">
            <section class="post-form-card glass">
                <form action="/post" method="POST" class="mt-4 post-form-flex">
                    <textarea name="text" rows="3" placeholder="What's on your mind?" required></textarea>
                    <button type="submit" class="mt-2 post-btn">
                        <span class="post-btn-content"><i class="fa-solid fa-paper-plane"></i> Post</span>
                    </button>
                </form>
                <div id="post-feedback" class="feedback" style="display:none;"></div>
            </section>
            <section class="timeline-section glass">
                <h3><i class="fa-solid fa-stream"></i> Timeline</h3>
                <div id="timeline">
                    <!-- Timeline will be loaded here -->
                </div>
            </section>
        </main>
    </div>
    <footer>
        &copy; 2025 bateekh
    </footer>
    <script>
    function loadTimeline() {
        fetch('/timeline')
            .then(res => res.text())
            .then(html => {
                document.getElementById('timeline').innerHTML = html;
            });
    }
    function loadFriends() {
        fetch('/friends').then(res => res.text()).then(html => {
            document.getElementById('friend-list').innerHTML = html;
        });
        fetch('/pending_requests').then(res => res.text()).then(html => {
            document.getElementById('pending-requests').innerHTML = html;
        });
        fetch('/sent_requests').then(res => res.text()).then(html => {
            document.getElementById('sent-requests').innerHTML = html;
        });
        fetch('/friend_suggestions').then(res => res.text()).then(html => {
            document.getElementById('friend-suggestions').innerHTML = html;
        });
    }
    loadTimeline();
    loadFriends();
    // Reload timeline after posting
    document.querySelector('form[action="/post"]').addEventListener('submit', function(e) {
        setTimeout(loadTimeline, 500);
        // Show feedback
        document.getElementById('post-feedback').style.display = 'block';
        document.getElementById('post-feedback').textContent = 'Posted!';
        setTimeout(() => document.getElementById('post-feedback').style.display = 'none', 1500);
    });
    // Send friend request
    document.getElementById('send-friend-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const uname = document.getElementById('friend-username').value;
        fetch('/send_friend_request', {
            method: 'POST',
            headers: {'Content-Type': 'application/x-www-form-urlencoded'},
            body: 'to=' + encodeURIComponent(uname)
        }).then(() => {
            loadFriends();
            // Show feedback
            document.getElementById('send-friend-feedback').style.display = 'block';
            document.getElementById('send-friend-feedback').textContent = 'Request sent!';
            setTimeout(() => document.getElementById('send-friend-feedback').style.display = 'none', 1500);
        });
    });
    // Accept/reject friend requests (pending-requests)
    document.getElementById('pending-requests').addEventListener('click', function(e) {
        if (e.target.classList.contains('accept-request')) {
            fetch('/accept_friend_request', {
                method: 'POST',
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                body: 'from=' + encodeURIComponent(e.target.dataset.from)
            }).then(() => loadFriends());
        } else if (e.target.classList.contains('reject-request')) {
            fetch('/reject_friend_request', {
                method: 'POST',
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                body: 'from=' + encodeURIComponent(e.target.dataset.from)
            }).then(() => loadFriends());
        }
    });
    // Cancel sent requests (sent-requests)
    document.getElementById('sent-requests').addEventListener('click', function(e) {
        if (e.target.classList.contains('cancel-request')) {
            fetch('/cancel_friend_request', {
                method: 'POST',
                headers: {'Content-Type': 'application/x-www-form-urlencoded'},
                body: 'to=' + encodeURIComponent(e.target.dataset.to)
            }).then(() => loadFriends());
        }
    });
    </script>
</body>
</html>